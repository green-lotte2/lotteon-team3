<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/adminLayout}">
<section id="admin-product-register" layout:fragment="content">
    <script>
        // cate1 선택 시 cate2 조회
        async function findCate2(cate1){
            const cate2Select = document.getElementById('cate2');
            console.log(cate1);
            const cate2s = await fetchGet(`/lotteon/admin/product/register/${cate1}`)
            // 기존 <option> 태그들 삭제
            cate2Select.innerHTML = "";
            for(const cate2 of cate2s){
                const cate2Option = `<option value="${cate2.cate2}">${cate2.c2Name}</option>`;
                console.log("cate2Option : " + cate2Option);
                // 태그 문자열 삽입
                cate2Select.insertAdjacentHTML('beforeend', cate2Option);
            }
        }
        // 판매 가격의 1%를 포인트에 자동 입력
        function inputPoint(textPrice){
            const pointInput = document.getElementById('pointInput');
            const price = Number(textPrice);
            if (price > 100){
                pointInput.value =  Math.floor(price / 100);
            }
        }
        const eOptionInputPanel = document.getElementById('eOptionInputPanel');
        // option 선택 Div 공개
        function prodOption(cate2){
            console.log("cate2" + cate2);
            // 남성의류나 여성의류
            if(cate2 == '11' || cate2 == '12'){
                document.getElementById('eOptionInputPanel').style.display = 'block';
            }
        }
        // option 선택란 추가
        let optionIndex = 1; // 최초 인덱스 값

        function addOption(button){
            const tr = button.closest('tr');
            const colorInput = tr.querySelector('.colorInput');
            const colorValue = colorInput.value;
            console.log("colorValue" + colorValue);

            // 기존 tr 태그 복사
            const newRow = document.querySelector('.eManualOptionRow').cloneNode(true);

            const tableBody = document.querySelector('#prodOptionTable');

            const newColorInput = newRow.querySelector('.colorInput');
            newColorInput.value = colorValue;

            tableBody.appendChild(newRow);

            // name 속성 증가
            let colorInput2 = newRow.querySelector('.colorInput');
            console.log(colorInput2);
            console.log(optionIndex);

            const newColor = 'optionList[' + optionIndex + '].color';
            const newColorName = 'optionList[' + optionIndex + '].colorName';
            const newSize = 'optionList[' + optionIndex + '].size';
            const newOpStock = 'optionList[' + optionIndex + '].opStock';
            colorInput2.setAttribute('name', newColor);
            newRow.querySelector('.colorName').setAttribute('name', newColorName);
            newRow.querySelector('.sizeSelect').setAttribute('name', newSize);
            newRow.querySelector('.opStockInput').setAttribute('name', newOpStock);



            optionIndex++; // 인덱스 값 증가
        }

    </script>
                <nav>
                    <h3>상품등록</h3>
                    <p>
                        HOME > 상품관리 > <strong>상품등록</strong>
                    </p>
                </nav>
                <!-- 상품등록 컨텐츠 시작 -->
                <article>
                    <form th:action="@{/admin/product/register}" method="post" enctype="multipart/form-data">
                        <!-- 상품분류 -->
                        <section>
                            <h4>상품분류</h4>
                            <p>
                                기본분류는 반드시 선택하셔야 합니다. 하나의 상품에 1개의 분류를 지정 합니다.
                            </p>
                            <table>
                                <tr>
                                    <td>1차 분류</td>
                                    <td>
                                        <select name="cate1" id="cate1" onchange="findCate2(this.value)">
                                            <th:block th:each="cate1, loop :${cate1List}">
                                                <option th:value="${cate1.cate1}">[[${cate1.c1Name}]]</option>
                                            </th:block>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2차 분류</td>
                                    <td>
                                        <select name="cate2" id="cate2" onchange="prodOption(this.value)">
                                            <option value="0">2차 분류 선택</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </section>

                        <!-- 기본정보 -->
                        <section>
                            <h4>기본정보</h4>
                            <p>
                                기본정보는 반드시 입력해야 합니다.
                            </p>
                            <table>
                                <tr>
                                    <td>상품명</td>
                                    <td><input type="text" name="prodName"/></td>
                                </tr>
                                <tr>
                                    <td>기본설명</td>
                                    <td>
                                        <span>상품명 하단에 상품에 대한 추가적인 설명이 필요한 경우에 입력</span>
                                        <input type="text" name="descript"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>제조사</td>
                                    <td><input type="text" name="company"/></td>
                                </tr>
                                <tr>
                                    <td>판매가격</td>
                                    <!-- 포인트 계산 함수 호출 -->
                                    <td><input type="text" name="price" onchange="inputPoint(this.value)"/> 원</td>
                                </tr>                                    
                                <tr>
                                    <td>할인율</td>
                                    <td>
                                        <span>0을 입력하면 할인율 없음</span>
                                        <input type="text" name="discount"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>포인트</td>
                                    <td>
                                        <span>0을 입력하면 포인트 없음</span>
                                        <input type="text" name="point" id="pointInput" placeholder="판매가격의 1% 자동 입력"/> 점
                                    </td>
                                </tr>
                                <tr>
                                    <td>재고수량</td>
                                    <td><input type="text" name="stock"/> 개</td>
                                </tr>
                                <tr>
                                    <td>배송비</td>
                                    <td>
                                        <span>0을 입력하면 배송비 무료</span>
                                        <input type="text" name="delivery"/> 원
                                    </td>
                                </tr>
                                <tr>
                                    <td>상품 썸네일</td>
                                    <td>
                                        <span>크기 190 x 190, 상품 목록에 출력될 이미지 입니다. </span>
                                        <input type="file" name="thumb190"/>

                                        <span>크기 230 x 230, 상품 메인에 출력될 이미지 입니다. </span>
                                        <input type="file" name="thumb230"/>

                                        <span>크기 456 x 456, 상품 상세에 출력될 이미지 입니다. </span>
                                        <input type="file" name="thumb456"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>상세 상품정보</td>
                                    <td>
                                        <span>크기 가로 860px 높이 제약없음, 크기 최대 1MB, 상세페이지 상품정보에 출력될 이미지 입니다.</span>
                                        <input type="file" name="detail860"/>
                                    </td>
                                </tr>
                            </table>                                
                        </section>
                        <!-- 상품 옵션 추가 -->
                        <div id="eOptionInputPanel" class="addForm _self_option_wrap" style="display: none;">
                            <h4>옵션</h4>
                            <div class="mBoard gCellSingle">
                                <table border="1" summary="" id="prodOptionTable" class="prodOptionTable">
                                    <thead>
                                    <tr>
                                        <th scope="col">색상</th>
                                        <th scope="col">사이즈</th>
                                        <th scope="col">재고량</th>
                                        <th scope="col">관리</th>
                                    </tr>
                                    </thead>
                                    <tbody class="center" id="eManualOptionTbody">
                                    <tr class="eHeading eManualOptionRow" optiongroup="0">
                                        <td>
                                            <datalist id="list" class="list">
                                                <option>#d8cec5</option>
                                                <option>#1a1dee</option>
                                                <option>#1e1e15</option>
                                                <option>#303030</option>
                                                <option>#bb0000</option>
                                            </datalist>
                                            <input type="color" name="optionList[0].color" list="list" style="width:70px;" class="colorInput">
                                            <input id="colorName" name="optionList[0].colorName" type="text" class="fText" style="width:150px;" placeholder="색상 이름을 입력">
                                        </td>
                                        <td>
                                            <select name="optionList[0].size" id="sizeSelect" class="sizeSelect">
                                                <option value="S">S</option>
                                                <option value="M">M</option>
                                                <option value="L">L</option>
                                                <option value="Xl">XL</option>
                                                <option value="Xl">XXL</option>
                                            </select>
                                        </td>
                                        <td class="left eBubbleArea" id="eOptionBubbleArea_0">
                                            <div class="bubbleArea">
                                                <div class="mBubble">
                                                    <div class="box">
                                                        <input class="ec-uipack-bubble-move-ctrl opStockInput" type="text" name="optionList[0].opStock" id="prodOptionStock">
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="left eBubbleArea">
                                            <div class="button">
                                                <button type="button" class="btnOption lv1Minus vaBottom"><span>삭제</span></button>
                                                <button type="button" class="btnOption lv1Plus vaBottom" onclick="addOption(this)"><span>추가</span></button>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="mCtrl typeFooter">
                                <div class="gRight">
                                    <button id="optionSubmit">모든 옵션 품목추가</button>
                                </div>
                            </div>
                        </div>
                        <!-- 상품정보 제공 고시 -->
                        <section>
                            <h4>상품정보 제공고시</h4>
                            <p>
                                [전자상거래에 관한 상품정보 제공에 관한 고시] 항목에 의거 등록해야 되는 정보입니다.
                            </p>
                            <table>
                                <tr>
                                    <td>상품상태</td>
                                    <td><input type="text" name="status" value="새상품"/></td>
                                </tr>
                                <tr>
                                    <td>부가세 면세여부</td>
                                    <td><input type="text" name="duty" value="과세상품"/></td>
                                </tr>
                                <tr>
                                    <td>영수증발행</td>
                                    <td><input type="text" name="receipt" value="발행가능 - 신용카드 전표, 온라인 현금영수증"/></td>
                                </tr>
                                <tr>
                                    <td>사업자구분</td>
                                    <td><input type="text" name="bizType" value="사업자 판매자"/></td>
                                </tr>                                
                                <tr>
                                    <td>원산지</td>
                                    <td><input type="text" name="origin" value="국내산"/></td>
                                </tr>                                
                            </table>                                
                        </section>
                        
                        <input type="submit" value="등록하기"/>
                    </form>
                </article>

                <p class="ico alert">
                    <strong>Warning!</strong>
                    전자상거래 등에서의 상품 등의 정보제공에 관한 고시에 따라 총 35개 상품군에 대해 상품 특성 등을 양식에 따라 입력할 수 있습니다.
                </p>
                <!-- 상품등록 컨텐츠 끝 -->
            </section>
